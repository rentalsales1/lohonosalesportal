<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard</title>

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Inter:wght@700;800&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">

    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Custom Script to Load Navbar -->
    <script>
        $(function(){
            $('#navbar').load('navbar.html');
        });
    </script>

    <style>
        body {
            height: 100%;
            width: 100%;
            min-height: 100vh;
            background-color: #fbfaff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            flex-direction: column; /* Ensure vertical stacking */
        }

        #navbar {
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            background: #ffffff; /* Adjust if needed */
            z-index: 1000; /* Ensure it stays above other content */
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1); /* Optional shadow */
        }

        main {
            width: 30rem; /* Adjusted width */
            background-color: #ffffff;
            box-shadow: 0px 5px 15px 8px #e4e7fb;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 0.5rem;
            overflow: hidden; /* Prevents overflow of content */
            margin-top: 6rem; /* Adjusted margin to account for the navbar */
        }

        #header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 1rem; /* Adjusted padding */
        }

        h1 {
            font-family: "Rubik", sans-serif;
            font-size: 1.5rem; /* Adjusted font size */
            color: #141a39;
            text-transform: uppercase;
            cursor: default;
        }

        #leaderboard {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #141a39;
            cursor: default;
            table-layout: auto; /* Ensure table fits within the container */
        }

        tr {
            transition: all 0.2s ease-in-out;
            border-radius: 0.2rem;
        }

        tr:not(:first-child):hover {
            background-color: #fff;
            transform: scale(1.05);
            box-shadow: 0px 5px 15px 8px #e4e7fb;
        }

        tr:nth-child(odd) {
            background-color: #f9f9f9;
        }

        tr:nth-child(1) {
            background-color: #5c5be5;
        }

        td {
            height: 4rem; /* Adjusted height */
            font-family: "Rubik", sans-serif;
            font-size: 1.2rem; /* Adjusted font size */
            padding: 0.8rem 1.5rem; /* Adjusted padding */
            position: relative;
            overflow: hidden; /* Prevent overflow within each cell */
        }

        td:not(.highlight) {
            color: black; /* Set default text color to black */
        }

        .highlight {
            color: white; /* White text color for the first item on the first page */
        }

        .number {
            font-size: 2rem; /* Adjusted font size */
            font-weight: bold;
            text-align: left;
        }

        .name {
            text-align: left;
            font-size: 1.1rem; /* Adjusted font size */
        }

        .points {
            font-weight: bold;
            font-size: 1.2rem; /* Adjusted font size */
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .gold-medal {
            height: 2.5rem; /* Adjusted height */
            margin-left: 1rem; /* Adjusted margin */
        }

        .pagination {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .pagination button {
            background-color: #5c5be5;
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            margin: 0 0.25rem;
            border-radius: 0.5rem;
            cursor: pointer;
        }

        .pagination button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="navbar"></div>
    <main>
        <div id="header">
            <h1>Ranking</h1>
        </div>
        <div id="leaderboard">
            <table id="leaderboardTable">
                <!-- Rows will be injected here by JavaScript -->
            </table>
            <div class="pagination">
                <button id="prevPage" disabled>&lt;</button>
                <button id="nextPage">&gt;</button>
            </div>
        </div>
    </main>

    <script>
        let currentPage = 1;
        const entriesPerPage = 5;
        let totalPages = 1; // Initialize totalPages

        async function loadLeaderboard() {
            try {
                const response = await fetch(`/api/leaderboard?page=${currentPage}&entriesPerPage=${entriesPerPage}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                const leaderboardTable = document.getElementById('leaderboardTable');
                leaderboardTable.innerHTML = ''; // Clear any existing rows

                data.entries.forEach((player, index) => {
                    const row = document.createElement('tr');

                    const numberCell = document.createElement('td');
                    numberCell.className = 'number';
                    numberCell.textContent = (currentPage - 1) * entriesPerPage + index + 1;

                    const nameCell = document.createElement('td');
                    nameCell.className = 'name';
                    nameCell.textContent = player.name;

                    const pointsCell = document.createElement('td');
                    pointsCell.className = 'points';

                    // Format points to remove leading zeros and commas
                    const formatPoints = (points) => {
                        return `${parseInt(points, 10).toLocaleString()}%`; // Converts to integer and formats as a number
                    };

                    pointsCell.textContent = formatPoints(player.points);

                    // Check if it's the first page and the first item
                    if (currentPage === 1 && index === 0) {
                        row.style.backgroundColor = '#5c5be5'; // Highlight in blue
                        numberCell.classList.add('highlight'); // White text for number
                        nameCell.classList.add('highlight'); // White text for name
                        pointsCell.classList.add('highlight'); // White text for points

                        // Add the gold medal image to the first place
                        const img = document.createElement('img');
                        img.className = 'gold-medal';
                        img.src = 'https://github.com/malunaridev/Challenges-iCodeThis/blob/master/4-leaderboard/assets/gold-medal.png?raw=true';
                        img.alt = 'gold medal';
                        pointsCell.appendChild(img);
                    } else {
                        if (index % 2 === 0) {
                            row.style.backgroundColor = '#f9f9f9'; // Grey for even rows
                        } else {
                            row.style.backgroundColor = '#ffffff'; // White for odd rows
                        }
                    }

                    row.appendChild(numberCell);
                    row.appendChild(nameCell);
                    row.appendChild(pointsCell);

                    leaderboardTable.appendChild(row);
                });

                totalPages = data.totalPages; // Update totalPages
                document.getElementById('prevPage').disabled = currentPage === 1;
                document.getElementById('nextPage').disabled = currentPage >= totalPages;
            } catch (error) {
                console.error('Error loading leaderboard data:', error);
                const leaderboardTable = document.getElementById('leaderboardTable');
                leaderboardTable.innerHTML = '<tr><td colspan="3">Failed to load leaderboard data.</td></tr>';
            }
        }

        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                loadLeaderboard();
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                loadLeaderboard();
            }
        });

        // Call the function to load the leaderboard data when the page loads
        window.onload = function() {
            loadLeaderboard();
            launchConfetti();
        };

        function launchConfetti() {
    // Launch confetti from the left side
    confetti({
        particleCount: 60,
        spread: 100,
        origin: { x: 0.1, y: 0.9 }, // Start from the left side
        shapes: ['Square'],
        scalar: 2.0
    });
    // Launch confetti from the middle
    confetti({
        particleCount: 50,
        spread: 100,
        origin: { x: 0.5, y: 0.9 }, // Start from the middle
        shapes: ['circle'],
        scalar: 2.0
    });

    // Launch confetti from the right side
    confetti({
        particleCount: 60,
        spread: 100,
        origin: { x: 0.9, y: 0.9 }, // Start from the right side
        shapes: ['Square'],
        scalar: 2.0
    });

    
}
    </script>
</body>
</html>
